# 基础概念

## 什么是网页解析规则？

网页解析规则是一组指令，用于告诉阅读器如何从网站上提取特定内容。通过这些规则，我们可以自动化地获取网页中的信息，如书籍名称、作者、章节列表和正文内容等。

## 核心工作原理

解析规则系统的工作流程如下：

1. **发送请求**: 向目标网站发送 HTTP 请求获取网页内容
2. **内容解析**: 使用选择器定位到目标元素
3. **属性提取**: 提取元素的特定属性值
4. **数据处理**: 通过管道函数对提取的数据进行处理
5. **结构化输出**: 返回最终处理后的结构化数据

## 支持的解析协议

### XPath（默认协议）
用于解析 HTML 内容，是最常用的选择器。

**示例**:
```xpath
//div[@class='content']        # 查找所有 class 为 content 的 div 元素
//div[1]                       # 查找第一个 div 元素
//div/a/@href                  # 查找 div 下的 a 元素并提取 href 属性
```

### JSONPath
用于解析 JSON 数据，以 `$` 开头。

**示例**:
```jsonpath
$.data.books[0].name          # 访问 JSON 数据中的特定字段
$..name                       # 递归查找所有 name 字段
```

## 属性提取

在选择器定位到元素后，我们需要提取元素的特定属性值：

- `@text`: 提取元素的纯文本内容
- `@html`: 提取元素的 HTML 内容
- `@href`: 提取链接地址
- `@src`: 提取图片地址等

**示例**:
```xpath
//div[@class='title']@text     # 提取标题文本
//img@src                      # 提取图片地址
//a@href                       # 提取链接地址
```

## 管道函数

使用 `|` 符号可以连接多个规则或函数，形成处理管道。所有函数规则都以 `dart.` 开头。

### 常用函数

- `dart.trim()`: 去除字符串首尾的空白字符
- `dart.replace(from, to)`: 替换字符串中的文本
- `dart.substring(start, end)`: 截取字符串的一部分
- `dart.match(pattern)`: 使用正则表达式匹配文本

**示例**:
```xpath
//div[@class='title']@text|dart.trim()|dart.replace(作者：,)
//div[@class='content']@text|dart.substring(0,100)
```

## 书源结构

一个完整的书源包含以下几个主要部分：

### 基础配置
- `name`: 书源名称
- `url`: 网站基础URL
- `charset`: 字符编码（默认utf8）
- `header`: HTTP请求头

### 功能模块
1. **搜索功能**: 用于搜索书籍
2. **详情页**: 获取书籍详细信息
3. **目录页**: 获取章节列表
4. **内容页**: 获取章节内容
5. **探索页**: 发现推荐书籍

## 规则编写基础

### 选择器优化
- 使用相对路径而不是绝对路径
- 优先使用唯一标识符（如id、class）
- 避免过于复杂的选择器

### 属性提取最佳实践
- 优先使用 `@text` 而不是 text() 函数
- 需要 HTML 内容时才使用 `@html`
- 注意处理特殊字符和空白字符

### 管道函数使用
- 合理组合多个函数
- 按照数据处理的逻辑顺序排列函数
- 避免过度复杂的正则表达式

通过理解这些基础概念，您就可以开始编写自己的网页解析规则了。